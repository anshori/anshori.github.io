<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="author" content="unsorry">
	<meta name="keywords" content="HTML,CSS,JavaScript,PHP">
	<meta name="description" content="Leaflet JS with spreadsheet point marker">

    <!-- Judul pada tab browser -->
    <title>Peta Kota Besar di Indonesia</title>

    <!-- Leaflet CSS Library -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

    <!-- Style untuk tampilan peta fullscreen -->
    <style>
      html, body, #map {
        height: 100%;
        width: 100%;
        margin: 0px;
      }
      .blinking{
            animation:blinkingText 0.8s infinite;
        }
        @keyframes blinkingText{
            0%{     color: #000;    }
            49%{    color: transparent; }
            50%{    color: transparent; }
            99%{    color:transparent;  }
            100%{   color: #000;    }
        }
    </style>
  </head>

  <body>
    <!-- Leaflet JavaScript Library -->
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    
    <!-- Feature Modal -->
    <div class="modal fade" id="featureModal" tabindex="-1" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button class="close" type="button" data-dismiss="modal" aria-hidden="true">Ã—</button>
            <h4 class="modal-title text-primary" id="feature-title"></h4>
          </div>
          <div class="modal-body" id="feature-info"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-dismiss="modal">Tutup</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- HTML Block untuk menampilkan peta -->
    <div id="map"></div>
    <script>
      /* Initial Map */
      var map = L.map('map').setView([-2.367064,118.872815],5); //lat, long, zoom
      
      /* Tile Basemap */
      var basemap0 = L.tileLayer('https://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}', {
        maxZoom: 20,
        subdomains:['mt0','mt1','mt2','mt3'],
        attribution: 'Google Terrain | <span class="blinking"><a href="https://docs.google.com/forms/d/e/1FAIpQLSc9fB0lAgltrRl9KPdj8DB1Lbhq9WaMkUvkl2U_L0U54Fixew/viewform?usp=pp_url" target="_blank">Klik untuk menambahkan Kota/Kabupaten</a></span> | <a href="https://docs.google.com/spreadsheets/d/1gke3GI-i_BvNuSNDr5ZTRkF9xyRiwimJ1JUOhSQpPUo/view?usp=sharing" target="_blank">Tabel Spreadsheet</a>'
      });
      var basemap1 = L.tileLayer('https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
        maxZoom: 20,
        subdomains:['mt0','mt1','mt2','mt3'],
        attribution: 'Google Satellite | <span class="blinking"><a href="https://docs.google.com/forms/d/e/1FAIpQLSc9fB0lAgltrRl9KPdj8DB1Lbhq9WaMkUvkl2U_L0U54Fixew/viewform?usp=pp_url" target="_blank">Klik untuk menambahkan Kota/Kabupaten</a></span> | <a href="https://docs.google.com/spreadsheets/d/1gke3GI-i_BvNuSNDr5ZTRkF9xyRiwimJ1JUOhSQpPUo/view?usp=sharing" target="_blank">Tabel Spreadsheet</a>'
      });
      basemap0.addTo(map); //Memanggil basemap untuk ditampilkan ketika halaman dipanggil
      
      var traffic = L.tileLayer('https://{s}.google.com/vt?lyrs=h@159000000,traffic|seconds_into_week:-1&style=3&x={x}&y={y}&z={z}', {
        maxZoom: 20,
        subdomains:['mt0','mt1','mt2','mt3'],
      });
      traffic.addTo(map);
      
      /* GeoJSON Point */
        var pointsample = L.geoJson(null, {
          pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {
              icon: L.icon({
                iconUrl: "assets/marker/redmarkerpeople48.png", //icon simbol
                iconSize: [48, 48], //ukuran icon simbol
                iconAnchor: [24, 48], //penempatan icon simbol
                popupAnchor: [0, -48], //penempatan popup terhadap icon simbol
              })
            });
          },
          /* Popup */
          onEachFeature: function (feature, layer) {
            if (feature.properties) {
              /* Variabel untuk memanggil atribut dari data geojson */
              var content = "<table class='table table-striped table-bordered table-condensed'>" + 
                //"<tr><th>Nama</th><td>" + feature.properties.nama + "</td></tr>" +
                "<tr><th>Deskripsi</th><td>" + feature.properties.deskripsi + "</td></tr>" +
                "<tr><th>Keterangan</th><td>" + feature.properties.keterangan + "</td></tr>" +
                "<tr><th>Foto</th><td><img src='" + feature.properties.foto + "' width='200' alt='Tidak ada'/></td></tr>" +
                "<tr><th>Kontributor</th><td>" + feature.properties.kontributor + "</td></tr>" +
                "</table>";
              layer.on({
                  click: function (e) {
                    $("#feature-title").html(feature.properties.nama);
                    $("#feature-info").html(content);
                    $("#featureModal").modal("show");
                  }
                });
            }
          }
        });
        /* memanggil data geojson point */
        $.getJSON("data/spreadsheetpoint.php", function (data) {
          pointsample.addData(data);
          map.addLayer(pointsample); //pointsample ditampilkan ketika halaman dipanggil
          map.fitBounds(pointsample.getBounds());
        });
        
        
        
        /* Control Layer */
        var baseMaps = {
          'Google Terrain': basemap0,
          'Google Satellite': basemap1,
        };
        var Layers = {
            'Traffic': traffic,
        }
        var layerControl = L.control.layers(baseMaps, Layers, {collapsed:true});
        layerControl.addTo(map);

    </script>
  </body>
</html>
